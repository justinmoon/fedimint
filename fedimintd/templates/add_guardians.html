{% extends "base.html" %}
{% block title %} Fedimint {% endblock %}

{% block content %}
<div class="container text-center mt-5">
    <!-- Show Your Federation Name -->
    <h1>Add the Other Guardians' Connection Strings for the {{federation_name}} Federation</h1>
    <form id="guardians_form" action="/post_guardians" method="post">
        {% for guardian in guardians %}
        {% if guardian.config_string != "" %}
            <div>{{loop.index0}}</div>
        <div class="input-group mt-3">
            <input type="text" class="form-control" id="my_connection_string" value="{{guardian.config_string}}"
                readonly>
            <!-- Copy button that copies contents of the connection string on click -->
            <div class="input-group-append">
                <button class="btn btn-outline-primary" type="button" id="copy-button">Copy</button>
            </div>
        </div>
        {% else %}
        <div class="input-group">
            <input type="text" class="form-control" id="{{guardian.name}}-connection_string"
                placeholder="Connection String">
        </div>
        {% endif %}
        {% endfor %}
        <button class="btn btn-primary mt-3" type="submit">Submit</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.querySelector("#copy-button").addEventListener("click", function (e) {
        const config = document.getElementById("my_connection_string");
        navigator.clipboard.writeText(config.value);
    });

    // make a json vec all connection strings on submit
    const form = document.querySelector("#guardians_form")
    form.addEventListener('formdata', async (e) => {
        let connection_strings = Array.from(form.querySelectorAll('input[type="text"]')).map((input) => input.value);
        e.formData.set("connection_strings", JSON.stringify(connection_strings))
    });

</script>
{% endblock %}

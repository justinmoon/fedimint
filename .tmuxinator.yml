name: fedimint-dev
root: .
socket_name: fedimint-dev
pre_window:
  - export RUST_BACKTRACE=1
  - source .tmpenv
  - alias lightning-cli="\$FM_LIGHTNING_CLI"
  - alias lncli="\$FM_LNCLI"
  - alias bitcoin-cli="\$FM_BTC_CLIENT"
  - alias fedimint-cli="\$FM_MINT_CLIENT"
  - alias gateway-cli="\$FM_GATEWAY_CLI"
  - alias mint_rpc_client="\$FM_MINT_RPC_CLIENT"
  - alias dbtool="\$FM_DB_TOOL"
  - alias restart="./scripts/restart-tmux.sh"
  - source scripts/lib.sh
tmux_detached: false
windows:
  - main:
      layout: main-vertical
      panes:
        - user:
            - source scripts/tmux-user-shell.sh
        - pool_state:
            - source scripts/lib.sh
            - sleep 10 # wait
            - watch -n 1 "${FM_MINT_CLIENT} pool state"
  - federation:
      layout: 3ed7,272x74,0,0{119x74,0,0,54,152x74,120,0[152x17,120,0,55,152x17,120,18,56,152x17,120,36,57,152x20,120,54,58]}
      panes:
        - user:
          - # empty user shell
        - bitcoind:
          - start_bitcoind &
          - fg
        - cln:
          - start_lightningd &
          - fg
        - lnd:
          - start_lnd &
          - fg
        - gateway:
          - start_gatewayd &
          - fg
        - federation:
          - run_dkg
          - cp $FM_CFG_DIR/client.json $FM_CFG_DIR/seeker/client.json
          - cp $FM_CFG_DIR/client.json $FM_CFG_DIR/provider_a/client.json
          - cp $FM_CFG_DIR/client.json $FM_CFG_DIR/provider_b/client.json
          - start_federation &
